<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>DeWobbler Remote Debugger</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.3"></script>
    <script src="https://unpkg.com/htmx.org/dist/ext/ws.js"></script>
    <style>
        /* Custom scrollbar for terminal feel */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; }
        ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
    </style>
</head>
<body class="bg-gray-950 text-gray-300 h-screen flex flex-col font-mono text-sm">

    <header class="bg-gray-900 p-3 border-b border-gray-800 flex justify-between items-center">
        <div class="flex items-center gap-2">
            <span class="w-3 h-3 rounded-full bg-red-500 animate-pulse"></span>
            <h1 class="font-bold text-gray-100">Attached to PID: {{ pid }}</h1>
        </div>
        <div class="text-xs text-gray-500">PEP 768 / sys.remote_exec</div>
    </header>

    <div hx-ext="ws" ws-connect="/api/v1/ws/attach/{{ pid }}" class="flex-1 flex flex-col overflow-hidden relative">
        
        <!-- Terminal out -->
        <div id="terminal-output" class="flex-1 p-4 overflow-y-auto whitespace-pre-wrap font-mono leading-relaxed"></div>

        <!-- In -->
        <div class="bg-gray-900 p-3 border-t border-gray-800">
            <form ws-send class="flex gap-2 items-center">
                <span class="text-green-500 font-bold">>>></span>
                <input 
                    name="command" 
                    type="text" 
                    class="flex-1 bg-transparent border-none outline-none text-white focus:ring-0 placeholder-gray-700"
                    placeholder="print(sys.version)" 
                    autocomplete="off"
                    autofocus
                >
            </form>
        </div>
    </div>

    <script>
        const outputDiv = document.getElementById('terminal-output');
        
        // Auto-scroll observer
        const observer = new MutationObserver(() => {
            outputDiv.scrollTop = outputDiv.scrollHeight;
        });
        observer.observe(outputDiv, { childList: true, subtree: true });

        // Focus keeper
        document.addEventListener('click', () => {
            document.querySelector('input').focus();
        });
        
        // Clear input manually to prevent HTMX flicker
        document.querySelector('form').addEventListener('submit', function() {
            setTimeout(() => this.reset(), 0);
        });
    </script>
</body>
</html>